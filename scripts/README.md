# Exercise Coin Build & Deploy Scripts

One-click scripts for deploying and building Exercise Coin.

## Quick Reference

| Platform | Script | Description |
|----------|--------|-------------|
| **Windows** | `windows\deploy-server.bat` | Deploy server stack |
| **Windows** | `windows\build-android.bat` | Build Android APK |
| **macOS** | `macos/deploy-server.sh` | Deploy server stack |
| **macOS** | `macos/build-ios.sh` | Build iOS app |

---

## Windows Scripts

### deploy-server.bat

**One-click server deployment for Windows.**

```batch
cd scripts\windows
deploy-server.bat
```

**What it does:**
1. Checks for Node.js, npm, Git (installs via winget if missing)
2. Optionally installs MongoDB
3. Creates `.env` configuration file
4. Installs dependencies for server, admin portal, exchange
5. Builds frontend apps
6. Creates startup scripts

**After running:**
```batch
scripts\windows\start-all.bat
```

**URLs:**
- API Server: http://localhost:3000
- Admin Portal: http://localhost:3001
- Exchange: http://localhost:3002

---

### build-android.bat

**One-click Android APK builder for Windows.**

```batch
cd scripts\windows
build-android.bat
```

**Prerequisites:**
- Node.js (installed automatically)
- Java JDK 17+ (installed automatically via winget)
- Android SDK (for local builds)

**Build Options:**
1. **Development APK** - Debug build, fast
2. **Preview APK** - Release APK for testing
3. **Production AAB** - For Google Play Store
4. **Local APK** - Build without Expo account

---

## macOS Scripts

### deploy-server.sh

**One-click server deployment for macOS.**

```bash
chmod +x scripts/macos/deploy-server.sh
./scripts/macos/deploy-server.sh
```

**What it does:**
1. Installs Homebrew (if missing)
2. Installs Node.js, Git via Homebrew
3. Optionally installs MongoDB
4. Creates `.env` configuration
5. Installs all dependencies
6. Creates startup scripts

**After running:**
```bash
./scripts/macos/start-all.sh
```

---

### build-ios.sh

**One-click iOS app builder for macOS.**

```bash
chmod +x scripts/macos/build-ios.sh
./scripts/macos/build-ios.sh
```

**Prerequisites:**
- macOS (required for iOS builds)
- Xcode (from Mac App Store)
- Xcode Command Line Tools
- CocoaPods (installed automatically)

**Build Options:**
1. **Development** - iOS Simulator build
2. **Preview** - TestFlight distribution
3. **Production** - App Store submission
4. **Local** - Xcode build (no Expo account)

---

## Server Stack Components

| Component | Port | Description |
|-----------|------|-------------|
| **API Server** | 3000 | Express.js backend |
| **Admin Portal** | 3001 | React admin dashboard |
| **Exchange** | 3002 | Trading platform |
| **MongoDB** | 27017 | Database |

---

## Environment Configuration

The deploy scripts create `server/.env` automatically:

```env
PORT=3000
MONGODB_URI=mongodb://localhost:27017/exercise-coin
JWT_SECRET=<auto-generated>
JWT_EXPIRES_IN=7d

# Coin Daemon
COIN_DAEMON_HOST=localhost
COIN_DAEMON_PORT=39338
COIN_DAEMON_USER=exercisecoin
COIN_DAEMON_PASS=password

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# Admin
ADMIN_JWT_SECRET=<auto-generated>
```

---

## Mobile App Configuration

Build scripts create `mobile-app/app.json` with:

```json
{
  "expo": {
    "name": "Exercise Coin",
    "slug": "exercise-coin",
    "ios": {
      "bundleIdentifier": "com.exercisecoin.app"
    },
    "android": {
      "package": "com.exercisecoin.app"
    }
  }
}
```

---

## Troubleshooting

### Windows: "winget not found"

Update Windows to version 1809+ or install App Installer from Microsoft Store.

### Windows: "Node.js not in PATH"

Close and reopen Command Prompt after installation.

### macOS: "Permission denied"

Make scripts executable:
```bash
chmod +x scripts/macos/*.sh
```

### macOS: Homebrew on Apple Silicon

Homebrew installs to `/opt/homebrew` on M1/M2 Macs. Add to PATH:
```bash
eval "$(/opt/homebrew/bin/brew shellenv)"
```

### iOS: "Xcode not found"

Install from Mac App Store, then:
```bash
sudo xcode-select --install
sudo xcodebuild -license accept
```

### Android: "JAVA_HOME not set"

The script attempts auto-detection. Manual setup:
```batch
setx JAVA_HOME "C:\Program Files\Microsoft\jdk-17.0.x"
```

### MongoDB connection failed

**Local:** Make sure MongoDB is running
- Windows: `net start MongoDB`
- macOS: `brew services start mongodb-community`

**Cloud:** Update `MONGODB_URI` in `.env`

---

## First-Time Admin Setup

After deployment, create an admin account:

```bash
curl -X POST http://localhost:3000/api/admin/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@exercisecoin.com",
    "password": "admin123",
    "name": "Admin"
  }'
```

---

## Production Deployment

For production, consider:

1. **Use Docker:**
   ```bash
   docker-compose up -d
   ```

2. **Set secure secrets** in `.env`

3. **Use MongoDB Atlas** for database

4. **Enable HTTPS** via reverse proxy (nginx)

5. **Set up monitoring** (PM2, Docker health checks)
